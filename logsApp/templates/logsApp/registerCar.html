{% extends "logsApp/layout.html" %} {% block body %}
<div class="main">
  <!-- Error Message Display -->
  <h1>{{inUseErr}}</h1>

  <div class="forms-cont">
    <!-- Form for Vehicle Receipt -->
    <div class="regCont">
      <h2>لاستلام المركبه</h2>
      <form action="{% url 'logsApp:add' %}" dir="rtl" method="post">
        {% csrf_token %}
        <div class="input-cont">
          <label class="labels" for="ceoNumber">الرقم الاداري</label>
          <input
            class="inpute"
            type="text"
            name="ceoNumber"
            id="ceoNumber"
            required
            placeholder="مثال: 23945"
          />

          <!-- Display for Employee Existence Error -->
          <div class="msg-cont">
            {% if empDoseNotEXISTS %}
            <div id="error-message" class="error-msg">
              {{ empDoseNotEXISTS }}
            </div>
            <script>
              setTimeout(function () {
                fadeOutMessage("error-message");
              }, 7000);
            </script>
            {% endif %}
          </div>

          <!-- Other Errors -->
          {% if EmpMErr %}
          <h3>{{EmpMErr}}</h3>
          {% endif %} {% if InUseCar_exists %}
          <h3>{{InUseCar_exists}}</h3>
          {% endif %}
        </div>

        <!-- Car Number Input -->
        <div class="input-cont">
          <label class="labels" for="carNumber">رقم السياره</label>
          <input
            class="inpute"
            type="text"
            name="carNumber"
            id="carNumber"
            placeholder="1-46793"
            required
          />

          <!-- Display for Car Existence Error -->
          <div class="msg-cont">
            {% if carDNE %}
            <div id="error-message-car" class="error-msg">{{carDNE}}</div>
            <script>
              setTimeout(function () {
                fadeOutMessage("error-message-car");
              }, 7000);
            </script>
            {% endif %}
          </div>

          <!-- Display for Vehicle In-use Error -->
          {% if inuse %}
          <h3>{{inuse}}</h3>
          {% endif %}

          <!-- Submit Button -->
          <input class="submit-btn" type="submit" value="تسجيل المركبه" />

          <!-- Success Message Display -->
          <div class="msg-cont">
            {% if sucssuMessge %}
            <div id="reg-succ-message" class="success-msg">
              {{sucssuMessge}}
            </div>
            <script>
              setTimeout(function () {
                fadeOutMessage("reg-succ-message");
              }, 7000);
            </script>
            {% endif %}
          </div>
        </div>
      </form>
    </div>

    <!-- Form for Vehicle Return -->
    <div class="regCont">
      <h2>لإعادة المركبه</h2>
      <form action="{% url 'logsApp:ret' %}" dir="rtl" method="post">
        {% csrf_token %}
        <div class="input-cont">
          <label class="labels" for="ceonumber"> الرقم الاداري </label>
          <input class="inpute" type="number" name="ceonumber" id="ceonumber" />

          <!-- Display for Return Error -->
          <div class="msg-cont">
            {% if retErrm %}
            <div id="ret-err-message" class="error-msg">{{retErrm}}</div>
            <script>
              setTimeout(function () {
                fadeOutMessage("ret-err-message");
              }, 7000);
            </script>
            {% endif %}
          </div>
        </div>

        <!-- Car Note Input -->
        <div class="input-cont">
          <label class="labels" for="note">ملاحظه على السياره</label>
          <input class="inpute" type="text" id="note" name="empnote" />

          <!-- Display for Car Return Error -->
          <div class="msg-cont">
            {% if retCarErr %}
            <div id="ret-car-err" class="error-msg">{{retCarErr}}</div>
            <script>
              setTimeout(function () {
                fadeOutMessage("ret-car-err");
              }, 7000);
            </script>
            {% endif %}
          </div>

          <!-- Submit Button -->
          <input class="submit-btn" type="submit" value="إعادة المركبه" />

          <!-- Return Success Message -->
          <div class="msg-cont">
            {% if retSucssM %}
            <div id="ret-succ-message" class="success-msg">{{retSucssM}}</div>
            <script>
              setTimeout(function () {
                fadeOutMessage("ret-succ-message");
              }, 7000);
            </script>
            {% endif %}
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Message Display -->
  {% if message %}
  <h1>{{message}}</h1>
  {% endif %}

  <!-- Vehicles In Use Section -->
  <div><h1>مركبات قيد الاستخدام</h1></div>
  <div class="inuseBorder">
    <div class="inUsCont">
      {% if l %} {% for n in l %}
      <div class="car-details">
        <div class="details">
          <div class="info">
            <p class="info-p">اسم المستخدم: {{n.employee.ceoName}}</p>
            <p class="info-p">الرقم الاداري: {{n.employee.ceoNumber}}</p>
            <p>{{n.employee.section}}</p>
            <div class="car-plate">
              <p>{{n.car.carNumber}}</p>
              <p>رقم اللوحه</p>
            </div>
            <p>تاريخ و وقت الاستلام</p>
            <p class="created-at">{{ n.created_at|date:"Y-m-d / h:i A" }}</p>
          </div>
        </div>
      </div>
      {% endfor %} {% else %}
      <h1>لاتوجد مركبات قيد الاستخدام</h1>
      {% endif %}
    </div>
  </div>
</div>

<!-- Script for fading out messages -->
<script>
  function fadeOutMessage(id) {
    var message = document.getElementById(id);
    if (message) {
      message.style.transition = "opacity 1s ease-out";
      message.style.opacity = 0;
      setTimeout(function () {
        message.style.display = "none";
      }, 1000);
    }
  }
</script>

{% endblock %}
