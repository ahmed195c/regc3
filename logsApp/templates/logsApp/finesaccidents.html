{% extends "logsApp/layout.html" %} {% block body %} {% load static %}

<link rel="stylesheet" type="text/css" href="{% static 'logsApp/fiAc.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'logsApp/finesstyle.css' %}" />

<h2 class="cards-title">سجل الحوادث</h2>
<button class="nav-link-btn show-hide-btn" onclick="toggleAccidentForm()">
  إضافة حادث
</button>

<form
  class="fine-form addEventForm"
  method="POST"
  enctype="multipart/form-data"
  id="addEventForm"
  style="display: {% if form_open %}block{% else %}none{% endif %}; opacity: 0; transition: opacity 0.5s ease-in-out;"
>
  {% csrf_token %}
  <label for="carNumber" class="form-label">رقم المركبة</label>
  <input
    class="input"
    type="text"
    id="carNumber"
    name="carNumber"
    value="{{ carNumber }}"
    required
  /><br />

  <label for="empNumber" class="form-label">رقم الموظف</label>
  <input
    class="input"
    type="text"
    id="empNumber"
    name="empNumber"
    value="{{ empNumber }}"
  /><br />

  <div class="msg-cont">
    {% if emp_err_message %}
    <div id="error-message-emp-not-exists" class="error-msg">
      {{ emp_err_message }}
    </div>
    <script>
      setTimeout(function () {
        fadeOutMessage("error-message-emp-not-exists");
      }, 7000);
    </script>
    {% endif %}
  </div>

  <label for="text" class="form-label">وصف الحادث</label>
  <textarea id="text" name="text" class="textarea">{{ text }}</textarea><br />

  <label for="reportPdfFile" class="form-label">تحميل تقرير (PDF)</label>
  <input
    type="file"
    id="reportPdfFile"
    name="reportPdfFile"
    accept="application/pdf"
    class="input-file"
  /><br />

  <label for="licenseFiles" class="form-label">تحميل رخصة القيادة (PDF أو صورة)</label>
  <input
    type="file"
    id="licenseFiles"
    name="licenseFiles"
    accept="application/pdf,image/*"
    multiple
    class="input-file"
  /><br />

  <label for="carPaperworkFile" class="form-label">تحميل أوراق السيارة (PDF)</label>
  <input
    type="file"
    id="carPaperworkFile"
    name="carPaperworkFile"
    accept="application/pdf"
    class="input-file"
  /><br />

  <label for="images" class="form-label">تحميل الصور</label>
  <input
    type="file"
    id="images"
    name="images"
    accept="image/*"
    multiple
    class="input-file"
  /><br />

  <button class="submit-form" type="submit">تسجيل</button>
</form>

<h2 class="cards-title">سجل المخالفات</h2>
<button class="nav-link-btn show-hide-btn" onclick="toggleFineForm()">
  إضافة مخالفة
</button>

<form
  action="{% url 'logsApp:finec' %}"
  method="POST"
  class="fine-form"
  id="fineForm"
  style="display: none; opacity: 0; transition: opacity 0.5s ease-in-out"
>
  {% csrf_token %}
  <div class="form-group">
    <label for="finedate" class="form-label">تاريخ المخالفة</label>
    <input
      type="date"
      name="finedate"
      id="finedate"
      class="input-date"
      required
    />
  </div>
  <div class="form-group">
    <label for="finetime" class="form-label">وقت المخالفة</label>
    <input
      type="time"
      name="finetime"
      id="finetime"
      class="input-time"
      required
    />
  </div>
  <div class="form-group">
    <label for="finecar" class="form-label">رقم السيارة</label>
    <input
      type="text"
      name="finecar"
      id="finecar"
      class="input-text"
      required
    />
  </div>
  <div class="form-group">
    <input type="submit" value="إرسال" class="submit-btn" />
  </div>
</form>

<div class="cards-container" style="direction: rtl">
  {% for fine in fines %}
  <div class="card">
    <!-- prettier-ignore -->
    <div
      class="card-header"
      style="background-color: {% if fine.fixin_date %}green{% elif fine.report_pdf_file %}lightblue{% else %}red{% endif %};"
    >
      <p>
        {% if fine.fixin_date %} السيارة تم إصلاحها {% elif fine.report_pdf_file %} السيارة في انتظار الإصلاح {% else %} الشخص الذي تسبب في الحادث غير
        محدد {% endif %}
      </p>
    </div>
    <div class="card-body">
      <p><strong>رقم المركبه:</strong> {{ fine.car.carNumber }}</p>
      <p><strong>وصف الحادث:</strong> {{ fine.text }}</p>
      <p>
        <strong>تاريخ تسجيل الحادث:</strong> {{ fine.created_at|date:"Y-m-d" }}
      </p>
      <p>
        <strong>وقت تسجيل الحادث:</strong> {{ fine.created_at|time:"h:i A" }}
      </p>
      {% if fine.employees.all %}
      <p><strong>المتسبب في الحادث</strong></p>
      <ul>
        {% for emp in fine.employees.all %}
        <li>{{ emp.ceoName }}</li>
        {% endfor %}
      </ul>
      {% else %}
      <p>المتسبب في الحادث: مجهول</p>
      {% endif %}
      <div class="images">
        {% for image in fine.images.all %}
        <img src="{{ image.image.url }}" alt="Fine Image" />
        {% endfor %}
      </div>
    </div>
    <div class="card-footer">
      <button onclick="location.href='{% url 'logsApp:carddetails' fine.id %}'">
        اظهار تفاصيل اكثر
      </button>
    </div>
  </div>
  {% endfor %}
</div>

<div class="cards-container" style="direction: rtl">
  {% for record in fine_records %}
  <div class="card">
    <div class="card-header">
      <p>{{ record.employe.ceoName }} - {{ record.car.carNumber }}</p>
    </div>
    <div class="card-body">
      <p>
        <strong>تاريخ المخالفة:</strong> {{ record.created_at|date:"Y-m-d" }}
      </p>
      <p><strong>وقت المخالفة:</strong> {{ record.created_at|time:"h:i A" }}</p>
      <p><strong>رقم السيارة:</strong> {{ record.car.carNumber }}</p>
    </div>
  </div>
  {% endfor %}
</div>

{% endblock %}
